---
import { Image, Picture } from "astro:assets";
import { formatDate, normalizeDate } from "@/lib/utils/date";
import ResourcesAdd from "@/assets/svgs/resources-add.astro";
import Calendar04 from "@/assets/svgs/calendar-04.astro";
import Divider from "@/components/bases/divider.astro";

const { article } = Astro.props;
const authors = article.authorData ? [article.authorData] : [];
const categories = article.categories ?? [];
const publishedAt = article.publishedAt || new Date().toISOString();
---

<section
  class="mb-4 flex flex-col lg:flex-col-reverse border-b border-b-base-300 lg:border-none pb-2 pt-0 lg:pt-4"
>
  <!-- HERO IMAGE -->
  <div class="container px-0 max-w-5xl lg:mt-4 overflow-hidden aspect-[20/9] rounded-md">
    {article.image?.url ? (
      <img
        src={article.image.url}
        alt={article.image.alt || article.title}
        loading="eager"
        class="w-full h-full object-cover"
      />
    ) : (
      <div class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-500">
        No image available
      </div>
    )}
  </div>

  <!-- TITLE -->
  <div class="container max-w-5xl pt-6 lg:pt-8">
    <h1 class="text-4xl lg:text-5xl font-bold text-center text-pretty">
      {article.title}
    </h1>

    <!-- CATEGORIES (optional row above meta) -->
    {categories.length > 0 && (
      <div class="mt-3 flex items-center justify-center gap-2 text-sm text-base-content/70">
        <ResourcesAdd size="15" />
        <div class="flex flex-wrap items-center gap-1">
          {categories.map((cat, index) => (
            <a href={`/categories/${cat.slug}`} class="a-01 font-semibold hover:underline">
              {cat.title}{index < categories.length - 1 ? ', ' : ''}
            </a>
          ))}
        </div>
      </div>
    )}

    <!-- META ROW: PUBLISHED TIME + AUTHORS -->
    <div class="mt-3 lg:mt-5 flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-6 text-sm text-base-content/70">
      <!-- Published time -->
      <span class="inline-flex items-center gap-1">
        <Calendar04 size="15" />
        <time class="hidden lg:inline" datetime={normalizeDate(publishedAt)}>
          {formatDate(normalizeDate(publishedAt), "long")}
        </time>
        <time class="inline lg:hidden" datetime={normalizeDate(publishedAt)}>
          {formatDate(normalizeDate(publishedAt), "short")}
        </time>
      </span>
      
      <!-- Divider - only show on larger screens when items are in a row -->
      <Divider class="hidden sm:block" />
       
      <!-- Authors -->
      <div class="flex flex-wrap items-center justify-center gap-4">
        {authors.map((author) => (
          <a
            href={`/authors/${author.slug?.current || author._id}`}
            class="flex items-center gap-2"
          >
            <div class="avatar">
              <div class="w-8 rounded-full">
                {author.image?.url ? (
                  <img
                    src={author.image.url}
                    alt={author.name}
                    width={32}
                    height={32}
                    loading="eager"
                    class="w-8 h-8 rounded-full object-cover"
                  />
                ) : (
                  <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-xs">
                    {author.name?.charAt(0) || 'A'}
                  </div>
                )}
              </div>
            </div>
            <span class="font-bold capitalize">{author.name}</span>
          </a>
        ))}
      </div>
    </div>
  </div>
</section>